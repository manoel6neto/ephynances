<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <ui:composition template="/template.xhtml">
        <ui:define name="title">
            <h:outputText value="Instalação Remota"></h:outputText>
        </ui:define>

        <ui:define name="body">
            <f:event type="preRenderView" listener="#{userController.ruleCheck(['ADMIN', 'USER'])}" />
            <h:form id="form">
                <p:tabView id="tabView">
                    <p:tab id="software" title="Software">
                        <p:outputLabel  value="Sistema Operacional: " for="menuOSSoftware"/>
                        <br />
                        <p:selectOneMenu id="menuOSSoftware" value="#{inventoryMachineController.selectSO}" required="false" filter="true" 
                                         filterMatchMode="startsWith" effect="fade" effectSpeed="1000" style="width: 170px">
                            <f:selectItem itemLabel="Selecione o sistema operacional" itemValue="" />
                            <f:selectItem itemLabel="Windows" itemValue="Windows" />
                            <f:selectItem itemLabel="Linux" itemValue="Linux" /> 
                            <p:ajax update="tableListMachinesSoftware selectOneMenuSoftwares" listener="#{inventoryMachineController.loadConfigUIOS}"/>
                        </p:selectOneMenu>  
                        <br />
                        <br />
                        <p:dataTable id="tableListMachinesSoftware" widgetVar="tableMachinesInstallSoftware" value="#{inventoryMachineController.listMachinesSelectSO}" var="item" lazy="true" selection="#{inventoryMachineController.selectedMachinesInstallSoftware}" rowKey="#{item}"
                                     rows="25" paginator="true"  paginatorPosition="bottom"
                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
                                     currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}"
                                     emptyMessage="Nenhum registro encontrado!" >                    

                            <p:column selectionMode="multiple" style="width:16px;text-align:center"/>

                            <p:column style="text-align: center" headerText="Nome*" sortBy="hostName">
                                <h:outputText value="#{item.hostName}" />
                            </p:column>      

                            <p:column width="150" style="text-align: center" headerText="IP's">
                                <h:outputText value="#{inventoryMachineController.listIps(item)}" />
                            </p:column>                       

                            <p:column style="text-align: center" headerText="Sistema*" sortBy="os">
                                <h:outputText value="#{item.os}" />
                            </p:column>  

                            <p:column style="text-align: center" headerText="Grupo*" sortBy="group.name">
                                <h:outputText value="#{item.group.name}" rendered="#{not empty item.group.name}"/>
                                <h:outputText value="-" rendered="#{empty item.group.name}"/>
                            </p:column>                      

                            <p:column width="30" style="text-align: center" headerText="Status" >                      
                                <p:graphicImage cache="off" alt="Ativo" title="Ativo" url="../resources/img/on.png" height="16" width="16" rendered="#{item.status}" />
                                <p:graphicImage cache="off" alt="Inativo" title="Inativo" url="../resources/img/off.png" height="16" width="16" rendered="#{not item.status}" />
                            </p:column>                         
                        </p:dataTable>
                        <br class="clear"/>
                        <br />
                        <p:selectOneMenu id="selectOneMenuSoftwares" value="#{inventoryMachineController.uploadSoftware.id}" required="false" filter="true" 
                                         filterMatchMode="startsWith" effect="fade" effectSpeed="1000" style="width: 170px" >
                            <f:selectItem itemLabel="Selecione um software" noSelectionOption="true" />
                            <f:selectItems value="#{inventoryMachineController.listSoftwaresSelectSO}" var="item" itemValue="#{item.id}"
                                           itemLabel="#{item.name}" /> 
                        </p:selectOneMenu> 
                        <p:commandButton ajax="false" action="#{inventoryMachineController.addSoftware}" value="Adicionar Software" />
                        <p:commandButton ajax="false" action="#{inventoryMachineController.installSoftware}" value="Instalar" />
                    </p:tab>
                    <p:tab id="drive" title="Drive">
                        <br />
                        <p:dataTable id="tableListMachinesDrive" widgetVar="tableMachinesInstallDrive" value="#{inventoryMachineController.listMachinesWindows}" var="itemDrive" lazy="true" selection="#{inventoryMachineController.selectedMachinesInstallDrive}" rowKey="#{itemDrive}"
                                     rows="25" paginator="true"  paginatorPosition="bottom"
                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
                                     currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}"
                                     emptyMessage="Nenhum registro encontrado!" >                    

                            <p:column selectionMode="multiple" style="width:16px;text-align:center"/>

                            <p:column style="text-align: center" headerText="Nome*" sortBy="hostName">
                                <h:outputText value="#{itemDrive.hostName}" />
                            </p:column>      

                            <p:column width="150" style="text-align: center" headerText="IP's">
                                <h:outputText value="#{inventoryMachineController.listIps(itemDrive)}" />
                            </p:column>                       

                            <p:column style="text-align: center" headerText="Sistema*" sortBy="os">
                                <h:outputText value="#{itemDrive.os}" />
                            </p:column>  

                            <p:column style="text-align: center" headerText="Grupo*" sortBy="group.name">
                                <h:outputText value="#{itemDrive.group.name}" rendered="#{not empty itemDrive.group.name}"/>
                                <h:outputText value="-" rendered="#{empty itemDrive.group.name}"/>
                            </p:column>                      

                            <p:column width="30" style="text-align: center" headerText="Status" >                      
                                <p:graphicImage cache="off" alt="Ativo" title="Ativo" url="../resources/img/on.png" height="16" width="16" rendered="#{itemDrive.status}" />
                                <p:graphicImage cache="off" alt="Inativo" title="Inativo" url="../resources/img/off.png" height="16" width="16" rendered="#{not itemDrive.status}" />
                            </p:column>                         
                        </p:dataTable>
                        <br class="clear"/>
                        <br />
                        <p:selectOneMenu value="#{inventoryMachineController.uploadDrive.id}" required="false" filter="true" 
                                         filterMatchMode="startsWith" effect="fade" effectSpeed="1000" style="width: 170px">
                            <f:selectItem itemLabel="Selecione um drive" noSelectionOption="true" />
                            <f:selectItems value="#{inventoryMachineController.listDrives}" var="item" itemValue="#{item.id}"
                                           itemLabel="#{item.name}" /> 
                        </p:selectOneMenu> 
                        <p:commandButton ajax="false" action="#{inventoryMachineController.addDrive}" value="Adicionar Drive" />
                        <p:commandButton ajax="false" action="#{inventoryMachineController.installDrive}" value="Instalar" />
                    </p:tab>   
                    <p:tab id="image" title="Clonagem de HD">
                        <p:outputLabel  value="Sistema Operacional: " for="menuSOImage"/>
                        <br />
                        <p:selectOneMenu id="menuSOImage" value="#{inventoryMachineController.selectSO}" required="false" filter="true" 
                                         filterMatchMode="startsWith" effect="fade" effectSpeed="1000" style="width: 170px">
                            <f:selectItem itemLabel="Selecione o sistema operacional" itemValue="" />
                            <f:selectItem itemLabel="Windows" itemValue="Windows" />
                            <f:selectItem itemLabel="Linux" itemValue="Linux" /> 
                            <p:ajax update="tableListMachinesImage selectOneMenuImages" listener="#{inventoryMachineController.loadConfigUIOS}"/>
                        </p:selectOneMenu>  
                        <br />
                        <br />
                        <p:dataTable id="tableListMachinesImage" widgetVar="tableMachinesInstallImage" value="#{inventoryMachineController.listMachinesSelectSO}" var="item" lazy="true" selection="#{inventoryMachineController.selectedMachinesInstallImage}" rowKey="#{item}"
                                     rows="25" paginator="true"  paginatorPosition="bottom"
                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
                                     currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}"
                                     emptyMessage="Nenhum registro encontrado!" >                    

                            <p:column selectionMode="multiple" style="width:16px;text-align:center"/>

                            <p:column style="text-align: center" headerText="Nome*" sortBy="hostName">
                                <h:outputText value="#{item.hostName}" />
                            </p:column>      

                            <p:column width="150" style="text-align: center" headerText="IP's">
                                <h:outputText value="#{inventoryMachineController.listIps(item)}" />
                            </p:column>                       

                            <p:column style="text-align: center" headerText="Sistema*" sortBy="os">
                                <h:outputText value="#{item.os}" />
                            </p:column>  

                            <p:column style="text-align: center" headerText="Grupo*" sortBy="group.name">
                                <h:outputText value="#{item.group.name}" rendered="#{not empty item.group.name}"/>
                                <h:outputText value="-" rendered="#{empty item.group.name}"/>
                            </p:column>                      

                            <p:column width="30" style="text-align: center" headerText="Status" >                      
                                <p:graphicImage cache="off" alt="Ativo" title="Ativo" url="../resources/img/on.png" height="16" width="16" rendered="#{item.status}" />
                                <p:graphicImage cache="off" alt="Inativo" title="Inativo" url="../resources/img/off.png" height="16" width="16" rendered="#{not item.status}" />
                            </p:column>                         
                        </p:dataTable>
                        <br class="clear"/>
                        <br />
                        
                        <p:selectOneMenu id="selectOneMenuImages" value="#{inventoryMachineController.uploadImage.id}" required="false" filter="true" 
                                         filterMatchMode="startsWith" effect="fade" effectSpeed="1000" style="width: 170px">
                            <f:selectItem itemLabel="Selecione a imagem" noSelectionOption="true" />
                            <f:selectItems value="#{inventoryMachineController.listImagesSelectSO}" var="item" itemValue="#{item.id}"
                                           itemLabel="#{item.id} - #{item.name}" /> 
                        </p:selectOneMenu> 
                        <p:commandButton ajax="false" action="#{inventoryMachineController.addImage}" value="Adicionar Imagem" />
                        <p:commandButton ajax="false" action="#{inventoryMachineController.installImage}" value="Instalar" />
                    </p:tab>  
                </p:tabView>
                <p:poll interval="30" listener="#{inventoryMachineController.updateTable}" update="@form:tabView:software:tableListMachinesSoftware, @form:tabView:image:tableListMachinesImage, @form:tabView:drive:tableListMachinesDrive" />
            </h:form>
        </ui:define>
    </ui:composition>

</html>
