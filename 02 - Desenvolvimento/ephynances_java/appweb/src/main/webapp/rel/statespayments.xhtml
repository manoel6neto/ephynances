<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html" 
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core" 
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <ui:composition template="/template.xhtml"> 
        <ui:define name="title"> 
            <h:outputText style="font-size: large" value="ENTRADAS POR ESTADO"/>
        </ui:define>
        <ui:define name="body"  >
            <h:form id="form" >
                <p:messages autoUpdate="true" showSummary="true" showDetail="true" />
                <br class="clear" />
                <p:fieldset legend="Filtro" toggleable="true" collapsed="false">
                    <br class="clear" />
                    <br />
                    <div style="alignment-adjust: central; vertical-align: central;" >
                        <p:outputLabel value="Estado: " for="menuStates" /><br />
                        <p:selectOneMenu id="menuStates" style="width: 200px" value="#{relController.selectedState}" required="false" effect="fade" converter="stateConverter">
                            <f:selectItem noSelectionOption="true" itemLabel="Todos" />
                            <f:selectItems value="#{relController.states}" var="state" itemLabel="#{state.name}" itemValue="#{state}" />
                        </p:selectOneMenu>
                        <p:commandButton style="color: #FF0000; vertical-align: top; alignment-adjust: central; margin-left: 10px; height: 25px;" action="#{relController.calcPaymentsForStates()}" value="Filtrar" update="form" ajax="false"/>
                    </div>
                    <br class="clear" />
                    <br />
                </p:fieldset>

                <br class="clear" />
                <br />
                <p:fieldset legend="Dados" toggleable="true" collapsed="false" >
                    <br class="clear" />
                    <br />
                    <div class="grid_4 alpha">
                        <p:panel closable="false" style="padding: 15px; width: 1065px" >
                            <h:outputText value="Valores Atualizados: " style="font-style: oblique; font-size: large; margin-right: 15px;" />
                            <h:outputText value="#{relController.formatValueToReais(relController.totalValuePayments.setScale(2))}" style="color: #FAFAFA; font-style: oblique; font-size: large; background-color: dodgerblue; padding: 10px;" />
                        </p:panel>
                    </div>

                    <br class="clear" />
                    <br />
                    <br />
                    <div>
                        <p:accordionPanel style="background-color: #D2D2D2; border: solid; border-width: 1px; border-color: #EBE9DE" value="#{relController.listKeys()}" var="agreement" multiple="true" rendered="#{relController.agreementsListPayments.size() > 0}">
                            <p:tab title="#{agreement.physisAgreementNumber}" titleStyle="color: #FF0000; font-style: oblique;" >
                                <br class="clear" />
                                <div>
                                    <br />
                                    <h:outputText value="#{relController.formatValueToReais(relController.calcTotalPaymentsForContract(agreement.id))}" style="color: #FAFAFA; font-style: oblique; font-size: large; background-color: green; padding: 10px;" />
                                    <br />
                                    <br />
                                    <br />
                                    <table>
                                        <thead>
                                            <td width="200" style="font-weight: bold">Data de pagamento</td>
                                            <td width="200" style="font-weight: bold">Valor do pagamento</td>
                                            <td width="400" style="font-weight: bold">Contrato e proponente</td>
                                            <td width="200" style="font-weight: bold">Vendedor</td>
                                        </thead>
                                        <tbody>
                                            <ui:repeat value="#{relController.returnListPaymentsForKey(agreement.id)}" var="payment" varStatus="status" id="repeatPayments">
                                                <tr>
                                                    <td>
                                                        <h:outputText value="#{relController.formatDate(payment.paymentDate)}"/>
                                                    </td>
                                                    <td>
                                                        <h:outputText value="#{relController.formatValueToReais(payment.totalValue.setScale(2))}"/>
                                                    </td>
                                                    <td>
                                                        <h:outputText value="#{relController.returnContactNumberAndProponenteAndUfSigla(payment)}"/>
                                                    </td>
                                                    <td>
                                                        <h:outputText value="#{relController.returnSellerName(payment)}"/>
                                                    </td>
                                                </tr>
                                            </ui:repeat>
                                        </tbody>
                                    </table>
                                    <br />
                                </div>
                            </p:tab>
                        </p:accordionPanel>
                        <br />
                        <h:outputText value="Nenhum registro encontrado" style="font-style: oblique; font-size: medium; text-align: center;" rendered="#{relController.agreementsListPayments.size() == 0}"/>
                    </div>
                </p:fieldset>
            </h:form>
        </ui:define>
    </ui:composition>
</html>