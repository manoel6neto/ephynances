<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html" 
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core">

    <ui:composition template="/template.xhtml"> 
        <ui:define name="title"> 
            <h:outputText  value="Cadastrar novo agendamento"/>
        </ui:define>
        <ui:define name="body">
            <f:event type="preRenderView" listener="#{userController.ruleCheck(['ADMIN', 'USER'])}" />
            <h:form id="form" styleClass="form" acceptcharset="iso-8859-1" enctype="multipart/form-data"> 
                <p:growl showDetail="false" showSummary="true" autoUpdate="true" sticky="true" />
                <br class="clear"/>
                <br />
                <div class="grid_2 alpha" >
                    <p:outputLabel  value="Data: " for="datetime" />
                    <p:calendar id="datetime" value="#{scheduledTaskController.scheduledTask.scheduledDatetime}" pattern="MM/dd/yyyy HH:mm" required="true" effect="drop" locale="pt" showButtonPanel="true" navigator="true" stepMinute="15"/>                       
                </div>

                <div class="grid_2 alpha">
                    <p:outputLabel  value="Sistema Operacional: " for="menuOS"/>
                    <p:selectOneMenu id="menuOS" value="#{scheduledTaskController.scheduledTask.so}" required="false" style="width: 170px">
                        <f:selectItem itemLabel="Todos" itemValue="Todos" />
                        <f:selectItem itemLabel="Windows" itemValue="Windows" />
                        <f:selectItem itemLabel="Linux" itemValue="Linux" />                            
                        <p:ajax update="@form:tableListMachines, @form:selectOneMenuSoftwares, @form:selectOneMenuImages" listener="#{scheduledTaskController.loadConfigUIOS}"/>
                    </p:selectOneMenu> 
                </div>

                <br class="clear"/>
                <br />
                <p:dataTable id="tableListMachines" widgetVar="tableListMachines" value="#{scheduledTaskController.listMachinesSelectSO}" var="item" lazy="true" selection="#{scheduledTaskController.selectedMachines}" rowKey="#{item}"
                             rows="25" paginator="true"  paginatorPosition="bottom"
                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
                             currentPageReportTemplate="{startRecord} - {endRecord} de {totalRecords}"
                             emptyMessage="Nenhum registro encontrado!" >                    

                    <p:column selectionMode="multiple" style="width:16px;text-align:center"/>

                    <p:column style="text-align: center" headerText="Nome*" sortBy="hostName">
                        <h:outputText value="#{item.hostName}" />
                    </p:column>      

                    <p:column width="150" style="text-align: center" headerText="IP's">
                        <h:outputText value="#{scheduledTaskController.listIps(item)}" />
                    </p:column>                       

                    <p:column style="text-align: center" headerText="Sistema*" sortBy="os">
                        <h:outputText value="#{item.os}" />
                    </p:column>  

                    <p:column style="text-align: center" headerText="Grupo*" sortBy="group.name">
                        <h:outputText value="#{item.group.name}" rendered="#{not empty item.group.name}"/>
                        <h:outputText value="-" rendered="#{empty item.group.name}"/>
                    </p:column>                      

                    <p:column width="30" style="text-align: center" headerText="Status" >                      
                        <p:graphicImage cache="off" alt="Ativo" title="Ativo" url="../resources/img/on.png" height="16" width="16" rendered="#{item.status}" />
                        <p:graphicImage cache="off" alt="Inativo" title="Inativo" url="../resources/img/off.png" height="16" width="16" rendered="#{not item.status}" />
                    </p:column>                         
                </p:dataTable>

                <br class="clear"/>
                <br />
                <div class="grid_2 alpha">
                    <p:outputLabel  value="Tarefa: " for="menuTask"/>
                    <p:selectOneMenu id="menuTask" value="#{scheduledTaskController.scheduledTask.task}" required="true" style="width: 170px" >
                        <f:selectItem itemLabel="Ligar" itemValue="Ligar" />
                        <f:selectItem itemLabel="Desligar" itemValue="Desligar" />                             
                        <f:selectItem itemLabel="Software" itemValue="Software" />
                        <f:selectItem itemLabel="Imagem" itemValue="Imagem" /> 
                        <f:selectItem itemLabel="Testes" itemValue="Testes" />
                        <f:selectItem itemLabel="Backup" itemValue="Backup" />                           
                        <p:ajax event="change" update="@form:pnlSubTask"/>
                    </p:selectOneMenu> 
                </div>

                <div class="grid_2 alpha">                   
                    <h:panelGroup id="pnlSubTask">
                        <h:panelGroup rendered="#{scheduledTaskController.viewSelectOneMenuSoftwares() or scheduledTaskController.viewSelectOneMenuImages() or scheduledTaskController.viewSelectManyCheckboxTests()}">                           
                            <p:outputLabel  value="Sub-tarefa: " rendered="#{scheduledTaskController.viewSelectOneMenuSoftwares() or scheduledTaskController.viewSelectOneMenuImages() or scheduledTaskController.viewSelectManyCheckboxTests()}"/>
                            <p:selectOneMenu id="selectOneMenuSoftwares" value="#{scheduledTaskController.uploadSoftware.id}" required="false" filter="true" 
                                             filterMatchMode="startsWith" effect="fade" effectSpeed="1000" style="width: 170px" rendered="#{scheduledTaskController.viewSelectOneMenuSoftwares()}">
                                <f:selectItem itemLabel="Selecione um software" noSelectionOption="true" />
                                <f:selectItems value="#{scheduledTaskController.listSoftwaresSelectSO}" var="item" itemValue="#{item.id}"
                                               itemLabel="#{item.name}" /> 
                            </p:selectOneMenu>   
                            
                            <p:selectOneMenu id="selectOneMenuImages" value="#{scheduledTaskController.uploadImage.id}" required="false" filter="true" 
                                             filterMatchMode="startsWith" effect="fade" effectSpeed="1000" style="width: 170px" rendered="#{scheduledTaskController.viewSelectOneMenuImages()}">
                                <f:selectItem itemLabel="Selecione uma imagem" noSelectionOption="true" />
                                <f:selectItems value="#{scheduledTaskController.listImagesSelectSO}" var="item" itemValue="#{item.id}"
                                               itemLabel="#{item.name}" /> 
                            </p:selectOneMenu>   
                            <p:selectManyCheckbox id="selectManyCheckboxTests" value="#{scheduledTaskController.selectedTests}" rendered="#{scheduledTaskController.viewSelectManyCheckboxTests()}">
                                <f:selectItem itemLabel="Processador" itemValue="processador" />
                                <f:selectItem itemLabel="MemÃ³ria" itemValue="memoria" />
                                <f:selectItem itemLabel="HD" itemValue="hd" />
                            </p:selectManyCheckbox>  
                        </h:panelGroup>
                    </h:panelGroup>  
                </div>
                <br class="clear"/>
                <br />
                <br class="clear"/>
                <div class="grid_12 alpha" style="line-height: 30px;" >
                    <p:commandButton styleClass="grid_1 alpha" ajax="false" action="#{scheduledTaskController.save}" value="Agendar" update="form" />
                    <h:link styleClass="grid_1"  outcome="list" value="Voltar"  />
                </div>
            </h:form>
        </ui:define>
    </ui:composition>
</html>
